import React, { useEffect, useState, useContext } from "react"; import { getAuditLogs } from "../api/auditlog"; import { AuthContext } from "../context/AuthContext"; const AuditLog = () => { const { token, user } = useContext(AuthContext); const [logs, setLogs] = useState([]); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); useEffect(() => { if (!token) return; setLoading(true); getAuditLogs(token) .then(setLogs) .catch(() => setError("Failed to load audit logs. Admins only.")) .finally(() => setLoading(false)); }, [token]); if (!user || !user.is_staff) { return <div className="text-red-600">Admin access only.</div>; } return ( <div className="max-w-4xl mx-auto p-4"> <h2 className="text-2xl font-bold mb-4">Audit Log</h2> {error && <div className="text-red-600 mb-2">{error}</div>} {loading ? ( <div>Loading...</div> ) : ( <table className="table-fixed w-full border"> <thead> <tr> <th className="p-2 border">Timestamp</th> <th className="p-2 border">User</th> <th className="p-2 border">Action</th> <th className="p-2 border">Target</th> <th className="p-2 border">Details</th> <th className="p-2 border">IP</th> </tr> </thead> <tbody> {logs.map((log) => ( <tr key={log.id} className="border-b"> <td className="p-2 border">{new Date(log.timestamp).toLocaleString()}</td> <td className="p-2 border">{log.actor_email}</td> <td className="p-2 border">{log.action}</td> <td className="p-2 border">{log.target_model} ({log.target_id})</td> <td className="p-2 border">{log.description}</td> <td className="p-2 border">{log.ip_address}</td> </tr> ))} </tbody> </table> )} </div> ); }; export default AuditLog; 